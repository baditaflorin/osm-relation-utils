require 'open-uri'
require 'active_support/core_ext/hash'
require 'logger'
require 'erb'
require 'nokogiri'

require './node.rb'
require './way.rb'
require './relation.rb'

require './journey/vertex.rb'
require './journey/edge.rb'
require './journey/journey.rb'

$logger = Logger.new(STDOUT)  
$logger.level = Logger::INFO

#cyclorelation_osm_ids = ["3094456", "3690929", "1588106", "2973482", "3202498", "3710231", "1967940", "3203934", "2315663", "3146165", "2377960", "3127746", "1077283", "1875125", "3616165", "1775665", "3254645", "3127856", "3202577", "2322663", "3407116", "1124914", "3203726", "3890026", "1357590", "1471863", "2878285", "2738881", "3188489", "3294932", "2588476", "3019947", "2885600", "4437867", "2271751", "2583961", "3094458", "3161683", "3920866", "2322061", "3598238", "1770660", "908975", "3484927", "337949", "3398470", "1077300", "3127205", "3117444", "3816535", "2816077", "216249", "3012678", "3235517", "269897", "2150523", "3444555", "3125020", "2783779", "1634783", "3170359", "2970517", "2897249", "3972478", "1450425", "2721365", "3729025", "123788", "3222690", "1121453", "3705894", "1121452", "3146164", "3964145", "3422186", "1534546", "3272241", "1116896", "2531539", "1775662", "2675471", "3146166", "2837262", "1989675", "3237870", "174543", "2463280", "2238368", "2463281", "2586135", "581944", "1551202", "3160245", "2377962", "1526065", "3368002", "2878258", "3209616", "1567568", "3202563", "3816533", "3092083", "349694", "2738882", "1069877", "2238173", "1855506", "3398468", "3209605", "215778", "2270349", "569001", "3370617", "1345347", "3079597", "3444554", "1796742", "2739276", "3202501", "3706379", "2066191", "3763983", "4119814", "2238175", "2167927", "3618804", "1933004", "3176589", "2738056", "3148513", "3072858", "3904555", "3987034", "174594", "215264", "3811815", "216244", "3126584", "1664189", "2764721", "1278665", "4099273", "349942", "1775657", "3890029", "3019946", "908141", "1276911", "2738997", "2238369", "1773473", "4221033", "1276914", "238684", "2743298", "239474", "2767006", "3173208", "2272402", "4067763", "349714", "1291457", "3127204", "2960859", "1656220", "3254246", "3330347", "3202562", "3182104", "3706401", "2739275", "2238419", "2798516", "2325037", "1642272", "3660595", "957106", "3348428", "3203785", "2202702", "3330346", "3959990", "3277791", "531194", "1116894", "2586136", "222639", "2213967", "2898825", "2657126", "1903804", "3202499", "4203958", "2322664", "1770661", "3556902", "3083842", "3330345", "1775658", "156138", "1632568", "3330348", "2452606", "3712027", "3943057", "3017284", "3090839", "3240690", "3284440", "1276912", "3619102", "3961190", "1110137", "3190328", "3203787", "911059", "2233675", "4257029", "2743267", "1618256", "2322665", "2322062", "2885521", "3735420", "2771777", "1859217", "2167926", "1701317", "3267126", "3660594", "3915548", "3072575", "3484926", "1115727", "3735422", "2236143", "3086625", "3163979", "3668346", "3193583", "1775663", "3368003", "269898", "1689399", "2296681", "2264048", "2238174", "3203740", "2296620", "3398469", "2624623", "2624625", "3330349", "3404184", "1597167", "2270348", "3301770", "174602", "3888429", "3750044", "3176588", "3331093", "569004", "2533994", "1567569", "3777457", "3410645", "2780062", "2322079", "969090", "2627952", "2383995", "3740347", "3890030", "1271083", "2885686", "3316559", "1430208", "1859216", "3830051", "3890028", "3972514", "4105562", "3669717", "4009938", "4277971", "3972513", "174604", "3484930", "4120337", "3126585", "4119815", "1028842", "2624624", "349703", "2435434", "2973494", "1551200", "2613397", "3168392", "2531538", "3176381", "3415318", "3081882", "3650397", "2238171", "3301769", "3226773", "1115729", "3202500", "3146161", "3959991", "4105412", "1475298", "3012808", "2850964", "3960668", "3085671", "3176590", "3598615", "3579286", "3161684", "2296512", "2417977", "3153065", "350004", "3094454", "3890020", "1605541", "2973890", "349361", "1608256", "1251750", "3176357", "3085674", "1357591", "3075716", "3762977", "349358", "238712", "2624621", "2320064", "3533989", "2738737", "4203957", "2322706", "2406235", "3904476", "3621889", "2898913", "3170378", "1276913", "3579285", "3193657", "52081", "3237876", "4155896", "3303302", "3274721", "1245147", "2533993", "2624622", "3316352", "174544", "1354283", "3634096", "1913134", "3209604", "1552942", "1554318", "3621052", "3081888", "3890022", "1775664", "3888428", "3203727", "2266490", "1069879", "215265", "3890024", "2885696", "3173426", "1400277", "3980994", "2586137", "3904535", "2794070", "3955274", "2614443", "3146163", "2850965", "3565455", "2322070", "2739384", "3161110", "2238665", "2519456", "3896548", "1141476", "238688", "2452585", "3742126", "3082102", "1524086", "349689", "3237871", "1775660", "1112311", "4105945", "1567128", "3921266", "2973372", "2405712", "349964", "2850963", "2315679", "3789455", "1989722", "1115728", "3393988", "3484924", "2167925", "2964926", "3190327", "2941614", "2322515", "1578956", "3173210", "3840700", "3203786", "3692463", "1110136", "349683", "2421783", "1096808", "1847670", "3090838", "3619934", "2586134", "4119813", "2418979", "536188", "957108", "1111283", "3176382", "2743415", "349355", "3182544", "2580976", "3241030", "3650396", "3840699", "349950", "3735421", "3274720", "2798515", "1662393", "2296514", "3221060", "3778871", "3890023", "4006210", "1069878", "957105", "3330351", "3404231", "2624626", "3270941", "3202505", "3766753", "1622066", "1271634", "3331094", "3148556", "3804733", "269896", "3434822", "3312115", "1251749", "2783780", "4155893", "1083785", "3712888", "2961566", "1966803", "911058", "2440385", "3612780", "3365351", "3113643", "546407", "3934193", "957107", "2909857", "1141452", "3609476", "2973883", "3734756", "3484921", "3170491", "1697473", "3209603", "3203734", "4155892", "3267125", "2832948", "1775659", "454851", "3841974", "174545", "1537026", "3193658", "2264059", "1475199", "3385005", "3176591", "3729024", "3202503", "2452586", "3921202", "3943056", "331222", "1776733", "3840698", "3841976", "238660", "1776734", "4257028", "3190326", "1341846", "214543", "1551201", "1567127", "1567570", "3484928", "2320065", "1394352", "2322713", "3203935", "3125017", "226262", "3072859", "2586150", "2271752", "3775863", "456937", "3316353", "1274229", "1111282", "3921239", "2054443", "1532103", "3634894", "174534", "2054445", "3658332", "3176592", "966695", "3484925", "3422185", "3952965", "3079596", "2177162", "4137081", "2054447", "2531540", "1276924", "2934164", "3436914", "3484922", "1475294", "2054452", "3126583", "2322077", "143934", "305089", "1137486", "3972523", "3840702", "2648428", "3235515", "3840701", "3733848", "2150522", "3202558", "2167048", "1363517", "4140326", "349362", "3404185", "3706370", "3598317", "3362713", "1532102", "1540704", "3127817", "3932470", "3237872", "2973371", "3407117"]

r = Osm::Relation.new(3407116)
r.load
r.determine_interconnections
r.to_html

j = Osm::Journey.new r
j.generate_journey
j.to_html
puts j.to_gpx